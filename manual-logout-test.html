<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logout Test - Global Pharma Trading</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        .step {
            background-color: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #007bff;
            border-radius: 4px;
        }
        .step h3 {
            margin-top: 0;
            color: #007bff;
        }
        .credentials {
            background-color: #e9ecef;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            margin: 10px 0;
        }
        .success {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .warning {
            background-color: #fff3cd;
            border-color: #ffeaa7;
            color: #856404;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .error {
            background-color: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        #results {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Logout Test Guide</h1>
        <h2>Global Pharma Trading - Cookie Clearing Verification</h2>
        
        <div class="warning">
            <strong>‚ö†Ô∏è Important:</strong> This guide helps you manually test the logout functionality for users with 2FA enabled. Make sure to have browser developer tools open during testing.
        </div>

        <div class="step">
            <h3>Step 1: Prepare Browser</h3>
            <ul>
                <li>Open Chrome, Firefox, or Edge</li>
                <li>Open Developer Tools (F12)</li>
                <li>Go to "Application" tab (Chrome) or "Storage" tab (Firefox)</li>
                <li>Navigate to "Cookies" section</li>
                <li>Look for <code>globalpharmatrading.co.uk</code> domain</li>
            </ul>
        </div>

        <div class="step">
            <h3>Step 2: Login with 2FA User</h3>
            <div class="credentials">
                Email: mhamzawazir1996@gmail.com<br>
                Password: Test123!
            </div>
            <ol>
                <li>Go to <a href="https://globalpharmatrading.co.uk/auth/login" target="_blank">https://globalpharmatrading.co.uk/auth/login</a></li>
                <li>Enter the credentials above</li>
                <li>Click "Login"</li>
                <li>You should see a message about checking email for verification code</li>
                <li>Check email for verification code</li>
                <li>Enter the verification code</li>
                <li>Complete the 2FA verification</li>
                <li><strong>Check cookies in dev tools - you should now see <code>pharmacy_auth</code> cookie</strong></li>
            </ol>
        </div>

        <div class="step">
            <h3>Step 3: Navigate to Dashboard</h3>
            <ul>
                <li>After successful login, you should be redirected to dashboard</li>
                <li>URL should be: <code>https://globalpharmatrading.co.uk/dashboard</code></li>
                <li>Verify you can see the dashboard content</li>
                <li><strong>Confirm <code>pharmacy_auth</code> cookie is still present in dev tools</strong></li>
            </ul>
        </div>

        <div class="step">
            <h3>Step 4: Test Logout</h3>
            <ol>
                <li>In the dashboard sidebar, click the "Logout" button</li>
                <li><strong>IMMEDIATELY check the developer tools cookies section</strong></li>
                <li>The <code>pharmacy_auth</code> cookie should be completely removed</li>
                <li>You should be redirected to the login page</li>
                <li>Try to navigate back to <code>/dashboard</code> - you should be redirected to login</li>
            </ol>
        </div>

        <div class="test-section">
            <h3>üîç Cookie Verification Checklist</h3>
            <div id="cookieChecklist">
                <label><input type="checkbox"> pharmacy_auth cookie visible after 2FA login</label><br>
                <label><input type="checkbox"> pharmacy_auth cookie removed after logout</label><br>
                <label><input type="checkbox"> Cannot access /dashboard after logout without re-login</label><br>
                <label><input type="checkbox"> No 401 errors or auth loops</label><br>
                <label><input type="checkbox"> Clean redirect to login page</label><br>
            </div>
        </div>

        <div class="test-section">
            <h3>üß™ Advanced Testing</h3>
            <button onclick="testLogoutAPI()">Test Logout API Directly</button>
            <button onclick="checkCurrentCookies()">Check Current Cookies</button>
            <button onclick="clearAllCookies()">Clear All Cookies</button>
            
            <div id="results"></div>
        </div>

        <div class="step">
            <h3>Step 5: Cross-Browser Testing</h3>
            <p>Repeat the above steps in:</p>
            <ul>
                <li>Chrome (regular and incognito)</li>
                <li>Firefox (regular and private)</li>
                <li>Edge (regular and InPrivate)</li>
                <li>Safari (if available)</li>
            </ul>
        </div>

        <div class="success">
            <h4>‚úÖ Success Criteria</h4>
            <ul>
                <li>pharmacy_auth cookie is set only after complete 2FA verification</li>
                <li>pharmacy_auth cookie is completely removed after logout</li>
                <li>User is redirected to login page after logout</li>
                <li>Cannot access protected routes after logout</li>
                <li>No browser console errors during logout process</li>
                <li>Same behavior across all browsers</li>
            </ul>
        </div>

        <div class="error">
            <h4>‚ùå Failure Indicators</h4>
            <ul>
                <li>pharmacy_auth cookie persists after logout</li>
                <li>User can still access dashboard after logout</li>
                <li>Console errors during logout</li>
                <li>Infinite redirect loops</li>
                <li>401 authorization errors</li>
            </ul>
        </div>
    </div>

    <script>
        function testLogoutAPI() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<p>Testing logout API...</p>';
            
            fetch('/api/auth/logout', {
                method: 'POST',
                credentials: 'include'
            })
            .then(response => {
                return response.json().then(data => ({
                    status: response.status,
                    headers: response.headers,
                    data: data
                }));
            })
            .then(result => {
                resultsDiv.innerHTML = `
                    <h4>Logout API Test Result:</h4>
                    <p><strong>Status:</strong> ${result.status}</p>
                    <p><strong>Response:</strong> ${JSON.stringify(result.data, null, 2)}</p>
                    <p><strong>Headers:</strong> Check Network tab for Set-Cookie headers</p>
                `;
            })
            .catch(error => {
                resultsDiv.innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
            });
        }
        
        function checkCurrentCookies() {
            const cookies = document.cookie.split(';').map(c => c.trim());
            const pharmaCookie = cookies.find(c => c.startsWith('pharmacy_auth='));
            const resultsDiv = document.getElementById('results');
            
            resultsDiv.innerHTML = `
                <h4>Current Cookies:</h4>
                <p><strong>All cookies:</strong> ${document.cookie || 'No cookies found'}</p>
                <p><strong>pharmacy_auth cookie:</strong> ${pharmaCookie || 'Not found ‚úÖ'}</p>
            `;
        }
        
        function clearAllCookies() {
            // Clear all cookies for this domain
            const cookies = document.cookie.split(";");
            for (let cookie of cookies) {
                const eqPos = cookie.indexOf("=");
                const name = eqPos > -1 ? cookie.substr(0, eqPos).trim() : cookie.trim();
                document.cookie = name + "=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/";
                document.cookie = name + "=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/;domain=.globalpharmatrading.co.uk";
                document.cookie = name + "=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/;domain=globalpharmatrading.co.uk";
            }
            
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<p style="color: green;">All cookies cleared! Check developer tools to verify.</p>';
        }
        
        // Auto-check current cookies on page load
        window.onload = function() {
            setTimeout(checkCurrentCookies, 1000);
        };
    </script>
</body>
</html>
