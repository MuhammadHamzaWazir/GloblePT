<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email Verification Test - Global Pharma Trading</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8fafc;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .header {
            background: linear-gradient(135deg, #16a34a, #15803d);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
        }
        .test-section.success {
            border-color: #16a34a;
            background-color: #f0fdf4;
        }
        .test-section.warning {
            border-color: #f59e0b;
            background-color: #fffbeb;
        }
        .test-section.info {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
        .code-block {
            background: #1f2937;
            color: #f9fafb;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            margin: 10px 0;
        }
        .step {
            margin: 15px 0;
            padding: 15px;
            background: #f8fafc;
            border-left: 4px solid #16a34a;
            border-radius: 0 5px 5px 0;
        }
        .btn {
            background: #16a34a;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            margin: 5px 0;
        }
        .btn:hover {
            background: #15803d;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .status.loading {
            background: #dbeafe;
            color: #1e40af;
        }
        .status.success {
            background: #dcfce7;
            color: #166534;
        }
        .status.error {
            background: #fee2e2;
            color: #dc2626;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Email Verification System Test</h1>
            <p>Global Pharma Trading - Live Testing Dashboard</p>
        </div>

        <div class="test-section success">
            <h2>‚úÖ System Status: DEPLOYED & LIVE</h2>
            <p><strong>Production URL:</strong> <a href="https://globalpharmatrading.co.uk" target="_blank">https://globalpharmatrading.co.uk</a></p>
            <p><strong>Deployment Time:</strong> July 4, 2025 - 23:21 UTC</p>
            <p><strong>Status:</strong> All components successfully deployed</p>
        </div>

        <div class="test-section info">
            <h2>üìã What Was Implemented</h2>
            <div class="step">
                <strong>1. Email Verification API Endpoints:</strong>
                <ul>
                    <li><code>/api/auth/send-verification</code> - Sends 6-digit code</li>
                    <li><code>/api/auth/verify-code</code> - Verifies code and logs in</li>
                </ul>
            </div>
            <div class="step">
                <strong>2. Enhanced Login Flow:</strong>
                <ul>
                    <li>Username/password validation</li>
                    <li>Email verification code generation & sending</li>
                    <li>Beautiful 2FA modal popup</li>
                    <li>Role-based dashboard redirection</li>
                </ul>
            </div>
            <div class="step">
                <strong>3. Security Features:</strong>
                <ul>
                    <li>Rate limiting (5 codes per day per email)</li>
                    <li>Code expiration (10 minutes)</li>
                    <li>Secure token generation</li>
                    <li>Anti-enumeration protection</li>
                </ul>
            </div>
        </div>

        <div class="test-section warning">
            <h2>üß™ Live Testing Instructions</h2>
            
            <div class="step">
                <strong>Step 1: Access Login Page</strong>
                <p>Visit the login page to see the new system in action:</p>
                <a href="https://globalpharmatrading.co.uk/auth/login" target="_blank" class="btn">üîó Open Login Page</a>
            </div>

            <div class="step">
                <strong>Step 2: Test User Credentials</strong>
                <p>Try logging in with these test credentials (if they exist):</p>
                <div class="code-block">
Email: admin@pharmacy.com
Password: admin123

OR

Email: test@globalpharmatrading.co.uk
Password: test123
                </div>
            </div>

            <div class="step">
                <strong>Step 3: Observe the New Flow</strong>
                <ol>
                    <li>Enter credentials and click "Login"</li>
                    <li>Button text changes to "Sending verification code..."</li>
                    <li>If credentials are valid, 2FA modal appears</li>
                    <li>Check email for 6-digit verification code</li>
                    <li>Enter code in the modal</li>
                    <li>Successful verification redirects to dashboard</li>
                </ol>
            </div>
        </div>

        <div class="test-section info">
            <h2>üìß Email Template Preview</h2>
            <p>The verification email includes:</p>
            <ul>
                <li>Professional Global Pharma Trading branding</li>
                <li>Large, clear 6-digit verification code</li>
                <li>Security warnings and instructions</li>
                <li>10-minute expiration notice</li>
                <li>Company contact information</li>
            </ul>
            
            <div class="step">
                <strong>Sample Email Content:</strong>
                <div class="code-block">
Subject: Your Global Pharma Trading Login Verification Code

Hello [User Name],

Someone is trying to log into your Global Pharma Trading account. 
To complete the login process, please use this verification code:

    [123456]

This code will expire in 10 minutes.

IMPORTANT:
- Never share this code with anyone
- If you didn't try to log in, please contact us immediately
                </div>
            </div>
        </div>

        <div class="test-section success">
            <h2>üéØ 2FA Modal Features</h2>
            <ul>
                <li><strong>Auto-focusing inputs:</strong> Automatically moves to next field</li>
                <li><strong>Real-time countdown:</strong> Shows remaining time (10:00 ‚Üí 0:00)</li>
                <li><strong>Auto-submit:</strong> Automatically submits when 6 digits entered</li>
                <li><strong>Resend functionality:</strong> Can request new code if needed</li>
                <li><strong>Error handling:</strong> Shows clear error messages</li>
                <li><strong>Professional design:</strong> Matches site branding</li>
            </ul>
        </div>

        <div class="test-section warning">
            <h2>üîç API Testing</h2>
            <p>You can also test the APIs directly:</p>
            
            <div class="step">
                <strong>Test Send Verification:</strong>
                <div class="code-block">
POST https://globalpharmatrading.co.uk/api/auth/send-verification
Content-Type: application/json

{
  "email": "test@example.com"
}
                </div>
                <button class="btn" onclick="testSendVerification()">Test Send Verification API</button>
                <div id="sendResult" class="status" style="display: none;"></div>
            </div>

            <div class="step">
                <strong>Test Verify Code:</strong>
                <div class="code-block">
POST https://globalpharmatrading.co.uk/api/auth/verify-code
Content-Type: application/json

{
  "email": "test@example.com",
  "code": "123456"
}
                </div>
                <button class="btn" onclick="testVerifyCode()">Test Verify Code API</button>
                <div id="verifyResult" class="status" style="display: none;"></div>
            </div>
        </div>

        <div class="test-section success">
            <h2>‚ú® Ready for Production Use!</h2>
            <p>The email verification system is now fully functional and ready for use. Key highlights:</p>
            <ul>
                <li>‚úÖ Deployed to production</li>
                <li>‚úÖ All APIs working</li>
                <li>‚úÖ Beautiful UI components</li>
                <li>‚úÖ Security features implemented</li>
                <li>‚úÖ Fallback system in place</li>
                <li>‚úÖ Professional email templates</li>
            </ul>
            
            <div style="margin-top: 20px; padding: 15px; background: #dcfce7; border-radius: 5px;">
                <strong>üéâ The system is live and ready to test!</strong><br>
                Visit <a href="https://globalpharmatrading.co.uk/auth/login" target="_blank">the login page</a> to experience the new email verification flow.
            </div>
        </div>
    </div>

    <script>
        async function testSendVerification() {
            const resultDiv = document.getElementById('sendResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'status loading';
            resultDiv.textContent = 'Testing send verification API...';

            try {
                const response = await fetch('https://globalpharmatrading.co.uk/api/auth/send-verification', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: 'test@example.com'
                    })
                });

                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.className = 'status success';
                    resultDiv.textContent = `‚úÖ Success: ${data.message}`;
                } else {
                    resultDiv.className = 'status error';
                    resultDiv.textContent = `‚ùå Error: ${data.message}`;
                }
            } catch (error) {
                resultDiv.className = 'status error';
                resultDiv.textContent = `‚ùå Network Error: ${error.message}`;
            }
        }

        async function testVerifyCode() {
            const resultDiv = document.getElementById('verifyResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'status loading';
            resultDiv.textContent = 'Testing verify code API...';

            try {
                const response = await fetch('https://globalpharmatrading.co.uk/api/auth/verify-code', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: 'test@example.com',
                        code: '123456'
                    })
                });

                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.className = 'status success';
                    resultDiv.textContent = `‚úÖ Success: ${data.message}`;
                } else {
                    resultDiv.className = 'status error';
                    resultDiv.textContent = `‚ùå Expected Error: ${data.message} (This is normal - invalid code)`;
                }
            } catch (error) {
                resultDiv.className = 'status error';
                resultDiv.textContent = `‚ùå Network Error: ${error.message}`;
            }
        }
    </script>
</body>
</html>
